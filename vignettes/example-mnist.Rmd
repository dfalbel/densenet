---
title: "DenseNet for classifying images in MNIST dataset"
author: "Daniel Falbel"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


In this example we will train a DenseNet to classify images from the MNIST
dataset.

```{r}
# Libraries ---------------------------------------------------------------
library(keras)
library(densenet)

# Parameters --------------------------------------------------------------

batch_size <- 32
epochs <- 200
num_classes <- 10

# Data Preparation --------------------------------------------------------

# the data, shuffled and split between train and test sets
mnist <- dataset_mnist()

x_train <- mnist$train$x
x_test <- mnist$test$x
dim(x_train) <- c(dim(x_train), 1)
dim(x_test) <- c(dim(x_test), 1)
x_train <- x_train / 255
x_test <- x_test / 255

y_train <- mnist$train$y
y_test <- mnist$test$y
y_train <- to_categorical(y_train, num_classes)
y_test <- to_categorical(y_test, num_classes)



input_shape <- dim(x_train)[-1]

# Model Definition -------------------------------------------------------

model <- densenet(
  nb_classes = 10, 
  img_dim = input_shape, 
  depth = 7, 
  nb_dense_block = 1, 
  growth_rate = 12,
  nb_filter = 16,
  dropout_rate = 0.2, 
  weight_decay = 1E-4
)

opt <- optimizer_adam(
  lr = 1e-3, 
  beta_1 = 0.9, 
  beta_2 = 0.999, 
  epsilon = 1e-08
)

model %>% compile(
  optimizer = opt,
  loss = "categorical_crossentropy",
  metrics = "accuracy"
)

# Model Fitting ---------------------------------------------------------

model %>%
  fit(
    x = x_train, y = y_train, 
    batch_size = batch_size, 
    epochs = epochs, 
    validation_data = list(x_test, y_test)
  )



```

